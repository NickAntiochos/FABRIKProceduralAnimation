<head>
	<title>
		FABRIK IK
	</title>
	<!-- Bootstrap fonts -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
	
	<!-- Bootstrap css -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<style>
		.bg-primary{
			color:GhostWhite;
			background-color:#cfe2ff;
		}
	</style>
	
	<script type="text/javascript">
		function loadDemo(){
		  document.querySelector('#demo-area').innerHTML = `
				<iframe frameborder="0" src="https://itch.io/embed-upload/6898021?color=333333" allowfullscreen="" width="640" height="380"><a href="https://nickantiochos.itch.io/fabrik-3d-demo">Play FABRIK 3D Demo on itch.io</a></iframe>
				<div class="card-text">
					 <b>Controls:</b>
					 <ul>
						 <li>
							 <i class="bi bi-arrows-move"></i> <b>WASD/Arrow Keys</b>
						 </li>
						 <li>
							 <b>Q &nbsp<i class="bi bi-arrow-counterclockwise"></i></b>
						 </li>
						 <li>
							 <b>E &nbsp<i class="bi bi-arrow-clockwise"></i></b>
						 </li>
						 <li>
							 <b>C &nbsp<i class="bi bi-sliders"></i></b>
						 </li>
					</ul>
				</div> 
			`;
		}
	</script>
</head>

<div class="jumbotron bg-primary text-center">
  <h2>Procedural Animation: FABRIK IK Solver</h2>
  <h4>Nicholas Antiochos</h4>
</div>

<center>
	<iframe width="560" height="315" src="https://www.youtube.com/embed/qhKrKs-H_1Y" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    The Problem
		  </div>
		  <div class="card-body">
		  	<p class="card-text">
		  		We have a rigged character that we would like to be animated dynamically in real time given non-stationary goals for the endpoints of each limb.
			</p>
		  </div>
		</div>
	</div>
  </div>


<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    Breakdown
		  </div>
		  <div class="card-body">
		  	<p class="card-text">
		  		We have a set of limbs made up of segments connected by joints. Each frame rendered, every individual limb needs to position its joints realistically so that its base is still connected, and the endpoint is hitting the desired goal.
			</p>
			<p class="card-text">
		  		If each limb is only made up of 2 segments with 1 joint, we essentially end up with a triangle where the 3 sides are the 2 limb segments and an imaginary line between the base of the joint and the goal. We know the length of all 3 sides, so we can apply the Law of Cosines to directly calculate the angle of the single joint. The problem is solved. However, this solution falls apart if there are multiple joints in the limb. It becomes even further complicated once we introduce constraints, after all, there are going to be certain ranges that we want our limbs to remain within.
			</p>
		  </div>
		</div>
	</div>
  </div>

<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    FABRIK Algorithm (with angular constraints)
		  </div>
		  <div class="card-body">
		  	<p class="card-text">
		  		Each iteration of Forward and Backward Reaching Inverse Kinematics (FABRIK) consists of two stages: the forward reach, and backward reach. There is no single way to implement constraints with FABRIK, but I chose to apply it to each joint after its backward reach is completed. For the sake of this explanation, I will refer to the joint at the base of the limb as the first joint, and the one closest to the end of the limb as the last joint. The end of the limb will have a target position that we will assume it is not already touching.
			</p>
			<p class="card-text">
		  		In the forward reach we iterate through each joint from last to first. The last joint (at the endpoint of the limb) turns so that its segment or bone is directed towards the target point. It is then moved so that the endpoint of the segment is touching this target. Each following joint turns so that its segment is directed towards the joint after it in the limb, and then moves until its segment’s endpoint is connected to the joint again. By the end of this stage, you should end up with the limb’s endpoint touching its target, and unless the optimal solution has been reached, the base of the limb will be disconnected.
			</p>
			<p class="card-text">
		  		In the backward reach, we iterate through each joint from first to last. The base joint is moved back to the limb’s starting position. If there is a constraint designated to this joint and it is currently out of range, it will be rotated so that it is adhering as closely to its original rotation as possible at the edge of its allowed rotation. Each following joint is rotated so that its segment is directed away from the joint preceding it in the limb, and it is moved back to the endpoint of the segment before it. Each joint’s angular constraint can be applied after its backward reach is completed as was done for the base. By the end of this stage an iteration of FABRIK has been completed and your base joint should be connected to the limb’s starting point. If the optimal solution has been reached, the limb’s endpoint should be connecting with the target. 
			</p>
			<p class="card-text">
		  		If the limb’s endpoint has entered the designated region of tolerance around the target, the algorithm can be terminated here. It is important to set a maximum number of iterations, as this way the algorithm will terminate even if the optimal solution is unreachable. If the optimal solution was unreachable, I chose to reload the stored joint angles from before FABRIK was run. I also used this as a sign that the target needed to be relocated, as in the context of my use case if a creature’s leg is no longer able to comfortably connect with the ground it would take a step or at the very least readjust its footing.
			</p>
		  </div>
		</div>
	</div>
  </div>

<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    Playable Demo
		  </div>
		  <div class="card-body">
			<p class="card-text">
			  This demo consists of a spider-like creature with limbs animated by my implementation of FABRIK in 3D. The spider can move in forwards, backwards, left, right, and rotate. Using the control sliders, the spider can be slowed down, have its color changed, or have its number of limbs adjusted.
		  	  <a href='https://nickantiochos.itch.io/fabrik-3d-demo'>link to download demo (better performance than browser version)</a>
			</p>
		  	<!--Embed for itch.io page with the demo-->
			  <div id="demo-area">
				  <button class="btn btn-success" onclick="loadDemo()">Load Demo</button>  
			  </div>
		  
			 
		
		  </div>
		</div>
	</div>
  </div>

<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    Additional Resources
		  </div>
		  <div class="card-body">
			<ul>
				
				<li>
					<a href='https://youtu.be/LVHM4spXuOM'>
						[Video] Inverse Kinematics in Shadow of the Colossus.
					</a>
				</li>
				<li>
					<a href='http://andreasaristidou.com/FABRIK.html'>
						Andreas Aristidou's work related to FABRIK
					</a>
				</li>
				<li>
					<a href='http://andreasaristidou.com/publications/papers/Extending_FABRIK_with_Model_C%CE%BFnstraints.pdf'>
						A technical explanation of FABRIK with model constraints
					</a>
				</li>
				<li>
					<a href='https://www.youtube.com/watch?v=li2N5U434Ck&t=357s'>
						Simple explanation of FABRIK (no constraints)
					</a>
				</li>
				<li>
					<a href='https://subscription.packtpub.com/book/programming/9781800208087/13/ch13lvl1sec09/implementing-constraints'>
						Implementation of Shoulder/Hinge constraints.
					</a>
				</li>
			</ul>
		  
			 
		
		  </div>
		</div>
	</div>
  </div>

<div class="row mb-4">
	<div class="col-sm-12">
		<div class="card">
		  <div class="card-header bg-primary">
		    Timeline
		  </div>
		  <ul>
			<li>
				<b>
					Week 5-6 
				</b>
				<ul>
					<li>
					Get a basic 2D demo of a FABRIK-animated limb (no constraints) in Godot
					</li>
					<li>
					Create overview powerpoint and this website
					</li>
				</ul>
			</li>
			<li>
				<b>
					Week 7-8 
				</b>
				<ul>
					<li>
		Work on extending 2D model to 3D (new dimensions of rotation involved)
					</li>
				</ul>
		</li>
		<li>
			<b>
			Week 9-10
			</b>
			<ul>
				<li>
				Work on implementing constraints
				</li>
				<li>
				Capture pictures/videos for week 10 progress report
				</li>
			</ul>
		</li>
		<li>
			<b>
			Week 11-12
			</b>
			<ul>
				<li>
				Work on website
				</li>
				<li>
				Set up a spider with FABRIK-animated limbs
				</li>
			</ul>
		</li>
		<li>
			<b>
			Week 13-END
			</b>
			<ul>
				<li>
				Tying up loose ends
				</li>
				<li>
				Finishing touches to website
				</li>
				<li>
				Stretch goals
				</li>
			</ul>
		</li>
		</ul>
		</div>
	</div>
  </div>
